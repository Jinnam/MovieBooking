<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.co.cinema.analisys.AnalisysMapper">
<!-- ///////////////////// 영화 통계 관련 ////////////////////// -->
 	<select id="selectMovieList" parameterType="String" resultType="Map">
 		SELECT
			MOVIE.mov_korName AS movKorName,
			MOVIE.mov_code AS movCode,
			MOVIE.mov_genre AS movGenre,
			`CHARACTER`.char_korName AS charKorName
		FROM
			MOVIE
		JOIN
			ANALYSIS
		ON
			MOVIE.mov_code=ANALYSIS.mov_code
		JOIN
			`CHARACTER`
		ON
			MOVIE.char_code = `CHARACTER`.char_code
		WHERE
			mov_korName	like #{movName}
 	</select>
 
 <!-- ///////////////////// 지점 통계 관련 ////////////////////// -->
 	<!-- 지점 정보 가져오기-->
 	<select id="selectBranchInfo" resultType="kr.co.cinema.dto.Branch">
 		SELECT
 			brc_code AS brcCode,
 			brc_name AS brcName,
 			brc_local AS brcLocal,
 			brc_addr AS brcAddr
 		FROM
 			BRANCH
 	</select>
 
	 <!-- 지점에서 영화 매출,예매수 확인 -->
	 <select id="seleceBrcCntSale" parameterType="Map" resultType="Map">
	 	SELECT
			BRANCH.brc_name AS brcName,
			MOVIE.mov_korName AS movKorName,
			BRANCH_DAY_COUNT.brcCnt_clientCount AS brcCntClientCount,
			BRANCH_DAY_COUNT.brcCnt_saleTotal AS brcCntSaleTotal,
			BRANCH_DAY_COUNT.brcCnt_date AS brcCntDate
		FROM
			BRANCH_DAY_COUNT
		JOIN
			BRANCH
		ON
			BRANCH_DAY_COUNT.brc_code=BRANCH.brc_code
		JOIN
			MOVIE
		ON
			BRANCH_DAY_COUNT.mov_code=MOVIE.mov_code
		WHERE
			BRANCH_DAY_COUNT.brcCnt_date between #{brcCntDate1} and #{brcCntDate2}
			<if test="brcName != 'main'">
		AND
			BRANCH.brc_name=#{brcName}	
			</if>
	 </select>
	 
	 <!-- 영화/지점/별로 예매/매출 가져오기 -->
	 <select id="selectSaleCnt" parameterType="Map" resultType="Map">
		SELECT
			MOVIE.mov_korName AS movKorName,
			BRANCH.brc_name AS brcName,
		<if test="cntKind=='예매'">
			sum(brcCnt_clientCount) AS brcCntClientCount
		</if>
		<if test="cntKind=='매출'">
			sum(brcCnt_saleTotal) AS brcCntSaleTotal
		</if>
		<if test="cntKind=='전체'">
			sum(brcCnt_clientCount) AS brcCntClientCount,
			sum(brcCnt_saleTotal) AS brcCntSaleTotal
		</if>
		FROM
			BRANCH_DAY_COUNT
		JOIN
			MOVIE
		ON
			BRANCH_DAY_COUNT.mov_code=MOVIE.mov_code
		JOIN
			BRANCH
		ON
			BRANCH_DAY_COUNT.brc_code=BRANCH.brc_code
		WHERE
			mov_korName=#{movKorName}
		<if test="brcName !='전체'">
		AND
			brc_name=#{brcName}
		</if>
		GROUP BY brc_name
	 </select>
	 <!-- 영화 정보 가져오기 -->
	 <select id="">
	 	SELECT
			MOVIE.mov_korName,
			ANALYSIS.anl_totalTicketCount,
			ANALYSIS.anl_totalTicketCount,
			ANALYSIS.anl_10sTicketCount,
			ANALYSIS.anl_20sTicketCount,
			ANALYSIS.anl_30sTicketCount,
			ANALYSIS.anl_40sTicketCount,
			ANALYSIS.anl_over50sTicketCount,
			ANALYSIS.anl_manTicketCount,
			ANALYSIS.anl_womanTicketCount,
			ANALYSIS.anl_acSales
		FROM
			ANALYSIS
		JOIN
			MOVIE
		ON
			ANALYSIS.mov_code=MOVIE.mov_code
		WHERE
			MOVIE.mov_code=#{movCode}
	 </select>
</mapper>