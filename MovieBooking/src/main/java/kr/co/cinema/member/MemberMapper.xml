<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.co.cinema.member.MemberMapper">
	
	<!-- 회원 탈퇴 비밀번호 중복 체크 -->
	<select id="selectMemberOverLapDelete" parameterType="String" resultType="String">
		select 
			mem_pw AS memPw
		from 
			MEMBER 
		where 
			mem_id=#{memId}
	</select>

	<!-- 공사중 -->
	<select id="selectMovieName" parameterType="String" resultType="kr.co.cinema.dto.Movie">
		select 
			MOVIE.mov_korName AS movKorName
		from 
			PAYMENT
		Join 
			SCREEN_SCHEDULE
		ON 
			PAYMENT.scs_code = SCREEN_SCHEDULE.scs_code
		JOIN
			MOVIE
		ON
			SCREEN_SCHEDULE.mov_code = MOVIE.mov_code
		where
			PAYMENT.mem_id=#{memId}
	</select>
	
	<!-- 마이페이지 회원의 예매(상영날짜) 가져오기 select 공사중-->
	<select id="selectPayment" parameterType="String" resultType="kr.co.cinema.dto.ScreenSchedule">
		SELECT
			SCREEN_SCHEDULE.scs_date AS scsDate,
			PAYMENT.pmt_code AS pmtCode
		FROM
			PAYMENT
		JOIN
			SCREEN_SCHEDULE
		ON
			PAYMENT.scs_code = SCREEN_SCHEDULE.scs_code
		WHERE
			PAYMENT.mem_id=#{memId}
	</select>
	
	
	<!-- 마이페이지 회원의 마일리지 가져오기 select-->
	<select id="selectMemberMileage" parameterType="String"	resultType="kr.co.cinema.dto.Mileage">
		select 
			mil_use AS milUse,
			mil_save AS milSave,
			mil_date AS milDate
		from 
			MILEAGE 
		where 
			mem_id=#{memId}
	</select>
	
	<!-- 마이페이지 회원 개인정보 수정하기 -->
	<update id="modifyMemberUpdate" parameterType="String">
		update 
			MEMBER 
		set 
			mem_pw=#{memPw},
			mem_phone=#{memPhone},
			mem_name=#{memName},
			mem_gender=#{memGender},
			mem_birth=#{memBirth},
			mem_postNo=#{memPostNo},
			mem_addr=#{memAddr},
			mem_mail=#{memMail}  
		where 
			mem_id=#{memId}
	</update>
	
	<!-- 한 회원 개인정보 가져오기 select -->
	<select id="selectOneMemberModify" parameterType="String" resultType="kr.co.cinema.dto.Member">
		select 
			mem_id AS memId,
			mem_pw AS memPw,
			mem_phone AS memPhone,
			mem_name AS memName,
			mem_gender AS memGender,
			mem_birth AS memBirth,
			mem_postNo AS memPostNo,
			mem_addr AS memAddr,
			mem_mail AS memMail
		from 
			MEMBER 
		where 
			mem_id=#{memId}
	</select>
	<!-- 한 회원 개인정보 가져오기  -->

	<!-- 비회원 가입 insert 시작 -->
	<insert id="insertNonMember" parameterType="kr.co.cinema.dto.NonMember">
		insert into NON_MEMBER(
			nmem_code,
			nmem_phone,
			nmem_name,
			nmem_birth,
			nmem_pw)
		values(
			#{nmemCode},
			#{nmemPhone},
			#{nmemName},
			#{nmemBirth},
			#{nmemPw})	
	</insert>
	<!-- 비회원 가입 insert 종료 -->

	<!-- 회원가입 중복확인 select 시작 -->
	<select id="selectMemeberOverlap" parameterType="String" resultType="String">
		select 
			mem_id AS memId
		from 
			MEMBER 
		where 
			mem_id=#{memId}
	</select>
	<!-- 회원가입 중복확인 select 종료 -->

	<!-- 회원 로그인 select 시작 -->
	<select id="selectMemberLogin" parameterType="Map" resultType="Map">
		select
			mem_id AS memId,
			mem_pw AS memPw,
			mem_name AS memName,
			mem_phone AS memPhone,
			mem_mileage AS memMileage,
			mem_joinDay AS	memJoinDay
		from 
			MEMBER
		where 
			mem_id=#{memId}
		and 
			mem_pw=#{memPw}
	</select>
	<!-- 회원 로그인 select 종료 -->

	<!-- 회원 가입 insert 시작 -->
	<insert id="insertMember" parameterType="kr.co.cinema.dto.Member">
		insert into MEMBER(
			mem_id,		
			mem_pw,
			mem_phone,
			mem_name,
			mem_gender,
			mem_birth,
			mem_postNo,
			mem_addr,
			mem_mail,
			mem_mileage,
			mem_joinDay,
			mem_status
		)values (
			#{memId},
			#{memPw},
			#{memPhone},
			#{memName},
			#{memGender},
			#{memBirth},
			#{memPostNo},
			#{memAddr},
			#{memMail},
			0,
			now(),
			'일반')
	</insert>
	<!-- 회원 가입 insert 종료 -->
	
	<!-- 회원 비밀번호 찾기 select 시작 -->
	<select id="selectOnePwFindMember" parameterType="kr.co.cinema.dto.Member" resultType="String">
		select
			mem_pw AS memPw
		from 
			MEMBER 
		where	
			mem_id=#{memId} and
			mem_name=#{memName} and
			mem_phone=#{memPhone} 	
	</select>
	<!-- 회원 비밀번호 찾기 select 종료 -->
	
	<!-- 회원 아이디 찾기 select 시작 -->
	<select id="selectOneIdFindMember" parameterType="kr.co.cinema.dto.Member" resultType="String">
		select
			mem_id AS memId 
		from 
			MEMBER 
		where 
			mem_name=#{memName} and 
			mem_birth=#{memBirth} and
			mem_phone=#{memPhone}
	</select>
	<!-- 회원 아이디 찾기 select 종료 -->
	
</mapper>